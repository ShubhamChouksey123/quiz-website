<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Quiz Admin - Add/Edit Question</title>

   <!-- Font Awesome for icons -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

   <!-- Custom Admin CSS -->
   <link rel="stylesheet" type="text/css" href="/css/admin-dashboard.css">

   <!-- jQuery -->
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<script th:inline="javascript">
    function validateFormAddQuestion() {
        var category = document.getElementById("categoryOption").value;
        var question = document.querySelector("input[name='question']").value;
        var answer = document.getElementById("answerOption").value;
        var optionA = document.querySelector("input[name='optionA']").value;
        var optionB = document.querySelector("input[name='optionB']").value;
        var optionC = document.querySelector("input[name='optionC']").value;
        var optionD = document.querySelector("input[name='optionD']").value;
        var difficulty = document.getElementById("difficulty_level").value;

        if (!category || category === "") {
            alert("Please select a category");
            return false;
        }

        if (!question || question.trim() === "") {
            alert("Please enter a question");
            return false;
        }

        if (!answer || answer === "") {
            alert("Please select an answer");
            return false;
        }

        if (!optionA || optionA.trim() === "" || !optionB || optionB.trim() === "" ||
            !optionC || optionC.trim() === "" || !optionD || optionD.trim() === "") {
            alert("Please fill in all options");
            return false;
        }

        if (!difficulty || difficulty === "") {
            alert("Please select a difficulty level");
            return false;
        }

        return true;
    }
</script>

<body>
   <div class="admin-container">
      <!-- Sidebar -->
      <aside class="sidebar">
         <div class="sidebar-header">
            <h2>Quiz Admin</h2>
            <p>Management Panel</p>
         </div>

         <nav class="sidebar-nav">
            <a href="/admin" class="nav-item">
               <i class="fas fa-chart-bar"></i>
               <span>Dashboard</span>
            </a>
            <a href="/admin?view=questions" class="nav-item">
               <i class="fas fa-question-circle"></i>
               <span>Questions</span>
            </a>
            <a href="/add-question" class="nav-item active">
               <i class="fas fa-plus-circle"></i>
               <span>Add Question</span>
            </a>
            <a href="/" class="nav-item">
               <i class="fas fa-home"></i>
               <span>Home</span>
            </a>
            <a href="/leaderboard" class="nav-item">
               <i class="fas fa-trophy"></i>
               <span>Leaderboard</span>
            </a>
            <a href="/contact" class="nav-item">
               <i class="fas fa-envelope"></i>
               <span>Contact</span>
            </a>
         </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
         <div class="content-header">
            <h1 th:text="${question != null && question.questionId != null ? 'Edit Question #' + question.questionId : 'Add New Question'}">Add New Question</h1>
            <p class="subtitle">Fill in the details below to add or edit a quiz question</p>
         </div>

         <!-- Success/Error Messages -->
         <div th:if="${successMessage}" class="alert alert-success" style="margin-bottom: 20px; padding: 15px; background-color: #d4edda; color: #155724; border-radius: 8px; border-left: 4px solid #28a745;">
            <i class="fas fa-check-circle"></i> <span th:text="${successMessage}"></span>
         </div>

         <div th:if="${errorMessage}" class="alert alert-error" style="margin-bottom: 20px; padding: 15px; background-color: #f8d7da; color: #721c24; border-radius: 8px; border-left: 4px solid #dc3545;">
            <i class="fas fa-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
         </div>

         <!-- Question Form -->
         <div class="form-container" style="background: white; border-radius: 12px; padding: 40px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <form id="addQuestionForm" method="post" action="/submit-add-question" onsubmit="return validateFormAddQuestion()">

               <!-- Hidden Question ID -->
               <input type="hidden" name="question_id" th:value="${question != null ? question.questionId : ''}" />

               <!-- Category -->
               <div class="form-group" style="margin-bottom: 25px;">
                  <label for="categoryOption" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                     <i class="fas fa-folder"></i> Category *
                  </label>
                  <select class="form-control" id="categoryOption" name="category" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;">
                     <option value="">Select a category</option>
                     <option value="GENERAL" th:selected="${question != null && question.category != null && question.category.name() == 'GENERAL'}">General</option>
                     <option value="HISTORY" th:selected="${question != null && question.category != null && question.category.name() == 'HISTORY'}">History</option>
                     <option value="FINANCE" th:selected="${question != null && question.category != null && question.category.name() == 'FINANCE'}">Finance</option>
                     <option value="SPORTS" th:selected="${question != null && question.category != null && question.category.name() == 'SPORTS'}">Sports</option>
                     <option value="SCIENCE_AND_TECHNOLOGY" th:selected="${question != null && question.category != null && question.category.name() == 'SCIENCE_AND_TECHNOLOGY'}">Science and Technology</option>
                     <option value="ENGINEERING" th:selected="${question != null && question.category != null && question.category.name() == 'ENGINEERING'}">Engineering</option>
                     <option value="ENTERTAINMENT" th:selected="${question != null && question.category != null && question.category.name() == 'ENTERTAINMENT'}">Entertainment</option>
                     <option value="GEOGRAPHY" th:selected="${question != null && question.category != null && question.category.name() == 'GEOGRAPHY'}">Geography</option>
                     <option value="LITERATURE" th:selected="${question != null && question.category != null && question.category.name() == 'LITERATURE'}">Literature</option>
                     <option value="FOOD_AND_CUISINE" th:selected="${question != null && question.category != null && question.category.name() == 'FOOD_AND_CUISINE'}">Food and Cuisine</option>
                     <option value="NATURE_AND_WILDLIFE" th:selected="${question != null && question.category != null && question.category.name() == 'NATURE_AND_WILDLIFE'}">Nature and Wildlife</option>
                     <option value="MYTHOLOGY_AND_RELIGION" th:selected="${question != null && question.category != null && question.category.name() == 'MYTHOLOGY_AND_RELIGION'}">Mythology and Religion</option>
                     <option value="POLITICS" th:selected="${question != null && question.category != null && question.category.name() == 'POLITICS'}">Politics</option>
                     <option value="MUSIC" th:selected="${question != null && question.category != null && question.category.name() == 'MUSIC'}">Music</option>
                  </select>
               </div>

               <!-- Question Statement -->
               <div class="form-group" style="margin-bottom: 25px;">
                  <label for="question" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                     <i class="fas fa-question"></i> Question *
                  </label>
                  <input type="text" class="form-control" id="question" name="question" placeholder="Enter your question here" th:value="${question != null ? question.statement : ''}" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;" />
               </div>

               <!-- Options Grid -->
               <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                  <div class="form-group">
                     <label for="optionA" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        <i class="fas fa-square" style="color: #e74c3c;"></i> Option A *
                     </label>
                     <input type="text" class="form-control" id="optionA" name="optionA" placeholder="Option A" th:value="${question != null ? question.optionA : ''}" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;" />
                  </div>

                  <div class="form-group">
                     <label for="optionB" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        <i class="fas fa-square" style="color: #f39c12;"></i> Option B *
                     </label>
                     <input type="text" class="form-control" id="optionB" name="optionB" placeholder="Option B" th:value="${question != null ? question.optionB : ''}" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;" />
                  </div>

                  <div class="form-group">
                     <label for="optionC" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        <i class="fas fa-square" style="color: #3498db;"></i> Option C *
                     </label>
                     <input type="text" class="form-control" id="optionC" name="optionC" placeholder="Option C" th:value="${question != null ? question.optionC : ''}" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;" />
                  </div>

                  <div class="form-group">
                     <label for="optionD" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        <i class="fas fa-square" style="color: #27ae60;"></i> Option D *
                     </label>
                     <input type="text" class="form-control" id="optionD" name="optionD" placeholder="Option D" th:value="${question != null ? question.optionD : ''}" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;" />
                  </div>
               </div>

               <!-- Answer and Difficulty Row -->
               <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                  <div class="form-group">
                     <label for="answerOption" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        <i class="fas fa-check-circle"></i> Correct Answer *
                     </label>
                     <select class="form-control" name="answer" id="answerOption" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;">
                        <option value="">Select correct answer</option>
                        <option value="0" th:selected="${question != null && question.ans != null && question.ans == 0}">A</option>
                        <option value="1" th:selected="${question != null && question.ans != null && question.ans == 1}">B</option>
                        <option value="2" th:selected="${question != null && question.ans != null && question.ans == 2}">C</option>
                        <option value="3" th:selected="${question != null && question.ans != null && question.ans == 3}">D</option>
                     </select>
                  </div>

                  <div class="form-group">
                     <label for="difficulty_level" style="display: block; font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                        <i class="fas fa-signal"></i> Difficulty Level *
                     </label>
                     <select class="form-control" name="difficulty_level" id="difficulty_level" style="width: 100%; padding: 12px; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 15px; transition: border-color 0.3s;">
                        <option value="">Select difficulty level</option>
                        <option value="LOW" th:selected="${question != null && question.difficulty != null && question.difficulty.name() == 'LOW'}">Low</option>
                        <option value="MEDIUM" th:selected="${question != null && question.difficulty != null && question.difficulty.name() == 'MEDIUM'}">Medium</option>
                        <option value="HIGH" th:selected="${question != null && question.difficulty != null && question.difficulty.name() == 'HIGH'}">High</option>
                     </select>
                  </div>
               </div>

               <!-- Action Buttons -->
               <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                  <a href="/admin" class="btn btn-secondary" style="padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; background-color: #95a5a6; color: white; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: background-color 0.3s;">
                     <i class="fas fa-times"></i> Cancel
                  </a>
                  <button type="submit" class="btn btn-primary" style="padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: inline-flex; align-items: center; gap: 8px; transition: transform 0.3s, box-shadow 0.3s;">
                     <i class="fas fa-save"></i> <span th:text="${question != null && question.questionId != null ? 'Update Question' : 'Save Question'}">Save Question</span>
                  </button>
               </div>
            </form>
         </div>
      </main>
   </div>

   <style>
      /* Form-specific styles */
      .form-control:focus {
         outline: none;
         border-color: #667eea !important;
         box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .btn-primary:hover {
         transform: translateY(-2px);
         box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary:hover {
         background-color: #7f8c8d;
      }

      /* Responsive design */
      @media (max-width: 768px) {
         .admin-container {
            flex-direction: column;
         }

         .sidebar {
            width: 100%;
            height: auto;
            position: relative;
         }

         .main-content {
            margin-left: 0;
            padding: 20px;
         }

         div[style*="grid-template-columns: 1fr 1fr"] {
            grid-template-columns: 1fr !important;
         }
      }
   </style>

</body>

</html>
